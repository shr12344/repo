#PRACTICAL 9: PENETRATION TESTING
#1. implementation for penetration testing 1.Port Scanning 2. Banner Grabbing 3. Simple Vulnerability Check

import socket
from datetime import datetime

# --- Dummy Vulnerability DB ---
vuln = {
    "Apache/2.2.8": "Outdated Apache - CVE-2009-3555",
    "OpenSSH_4.7": "Old OpenSSH - Remote Exploit",
    "Microsoft-IIS/6.0": "IIS 6.0 Deprecated - Multiple Attacks"
}

# --- Scan Ports ---
def scan(target, ports):
    print(f"\n[*] Scanning {target} ...")
    open_p = []
    for p in ports:
        try:
            s = socket.socket(); s.settimeout(0.5)
            if s.connect_ex((target, p)) == 0:
                print(f"[+] Port {p} OPEN"); open_p.append(p)
            s.close()
        except: pass
    return open_p

# --- Grab Banner ---
def banner(ip, port):
    try:
        s = socket.socket(); s.settimeout(1); s.connect((ip, port))
        data = s.recv(1024).decode().strip(); s.close(); return data
    except: return None

# --- Check Vulnerability ---
def check(ban):
    for k,v in vuln.items():
        if k in ban: return v
    return "No known vulnerability."

# --- Main ---
if __name__ == "__main__":
    t = input("Enter Target IP (e.g., 127.0.0.1): ")
    ports = [21,22,23,25,80,110,143,443,3389]
    start = datetime.now()
    open_ports = scan(t, ports)
    print("\n[*] Banner & Vulnerability Check:")
    for p in open_ports:
        b = banner(t, p)
        print(f"\n[Port {p}] Service Banner: {b}" if b else f"\n[Port {p}] No banner retrieved.")
        if b: print("    ->", check(b))
    print("\n[*] Scan completed in:", datetime.now() - start)
